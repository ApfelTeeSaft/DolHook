/**
 * DolHook Banner Display
 * Full VI (Video Interface) + XFB (External Frame Buffer) implementation
 * Implements complete hardware initialization and YUV framebuffer rendering
 */

#include "dolhook.h"
#include <string.h>

extern void OSReport(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* ============================================================================
 * VI Hardware Registers (0xCC002000 base)
 * ========================================================================= */

#define VI_BASE 0xCC002000

#define VI_VTR          (*(volatile uint16_t*)(VI_BASE + 0x00))
#define VI_DCR          (*(volatile uint16_t*)(VI_BASE + 0x02))
#define VI_HTR0         (*(volatile uint32_t*)(VI_BASE + 0x04))
#define VI_HTR1         (*(volatile uint32_t*)(VI_BASE + 0x08))
#define VI_VTO          (*(volatile uint32_t*)(VI_BASE + 0x0C))
#define VI_VTE          (*(volatile uint32_t*)(VI_BASE + 0x10))
#define VI_BBOI         (*(volatile uint32_t*)(VI_BASE + 0x14))
#define VI_BBEI         (*(volatile uint32_t*)(VI_BASE + 0x18))
#define VI_TFBL         (*(volatile uint32_t*)(VI_BASE + 0x1C))
#define VI_TFBR         (*(volatile uint32_t*)(VI_BASE + 0x20))
#define VI_BFBL         (*(volatile uint32_t*)(VI_BASE + 0x24))
#define VI_BFBR         (*(volatile uint32_t*)(VI_BASE + 0x28))
#define VI_DPV          (*(volatile uint16_t*)(VI_BASE + 0x2C))
#define VI_DPH          (*(volatile uint16_t*)(VI_BASE + 0x2E))
#define VI_DI0          (*(volatile uint32_t*)(VI_BASE + 0x30))
#define VI_DI1          (*(volatile uint32_t*)(VI_BASE + 0x34))
#define VI_DI2          (*(volatile uint32_t*)(VI_BASE + 0x38))
#define VI_DI3          (*(volatile uint32_t*)(VI_BASE + 0x3C))
#define VI_DL0          (*(volatile uint32_t*)(VI_BASE + 0x40))
#define VI_DL1          (*(volatile uint32_t*)(VI_BASE + 0x44))
#define VI_HSW          (*(volatile uint16_t*)(VI_BASE + 0x48))
#define VI_HSR          (*(volatile uint16_t*)(VI_BASE + 0x4A))
#define VI_FCT0         (*(volatile uint32_t*)(VI_BASE + 0x4C))
#define VI_FCT1         (*(volatile uint32_t*)(VI_BASE + 0x50))
#define VI_FCT2         (*(volatile uint32_t*)(VI_BASE + 0x54))
#define VI_FCT3         (*(volatile uint32_t*)(VI_BASE + 0x58))
#define VI_FCT4         (*(volatile uint32_t*)(VI_BASE + 0x5C))
#define VI_FCT5         (*(volatile uint32_t*)(VI_BASE + 0x60))
#define VI_FCT6         (*(volatile uint32_t*)(VI_BASE + 0x64))
#define VI_AA           (*(volatile uint16_t*)(VI_BASE + 0x68))
#define VI_VICLK        (*(volatile uint16_t*)(VI_BASE + 0x6C))
#define VI_VISEL        (*(volatile uint16_t*)(VI_BASE + 0x6E))
#define VI_HBE          (*(volatile uint16_t*)(VI_BASE + 0x70))
#define VI_HBS          (*(volatile uint16_t*)(VI_BASE + 0x72))

/* XFB dimensions */
#define XFB_WIDTH       640
#define XFB_HEIGHT_NTSC 480
#define XFB_HEIGHT_PAL  574
#define XFB_STRIDE      (XFB_WIDTH * 2)  /* 2 bytes per pixel in YUY2 */

/* Static framebuffer - must be 32-byte aligned for cache operations */
static uint8_t g_xfb[XFB_WIDTH * XFB_HEIGHT_NTSC * 2] __attribute__((aligned(32)));
static int g_vi_initialized = 0;

/* Video mode constants */
#define VI_NTSC 0
#define VI_PAL  1

/* ============================================================================
 * 8x8 Bitmap Font (Complete ASCII 32-126)
 * ========================================================================= */

static const uint8_t font_8x8[95][8] = {
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' 32 */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' 33 */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' 34 */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' 35 */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* '/**
 * DolHook Banner Display
 * Full VI (Video Interface) initialization and text rendering
 */

#include "dolhook.h"
#include <string.h>

extern void OSReport(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* ============================================================================
 * VI Hardware Registers
 * ========================================================================= */

#define VI_BASE 0xCC002000

/* VI Register offsets */
#define VI_VTR          (*(volatile uint16_t*)(VI_BASE + 0x00))  // Vertical Timing
#define VI_DCR          (*(volatile uint16_t*)(VI_BASE + 0x02))  // Display Configuration
#define VI_HTR0         (*(volatile uint32_t*)(VI_BASE + 0x04))  // Horizontal Timing 0
#define VI_HTR1         (*(volatile uint32_t*)(VI_BASE + 0x08))  // Horizontal Timing 1
#define VI_VTO         (*(volatile uint32_t*)(VI_BASE + 0x0C))  // Vertical Timing Odd
#define VI_VTE         (*(volatile uint32_t*)(VI_BASE + 0x10))  // Vertical Timing Even
#define VI_BBOI        (*(volatile uint32_t*)(VI_BASE + 0x14))  // Burst Blanking Odd Interval
#define VI_BBEI        (*(volatile uint32_t*)(VI_BASE + 0x18))  // Burst Blanking Even Interval
#define VI_TFBL        (*(volatile uint32_t*)(VI_BASE + 0x1C))  // Top Field Base Left
#define VI_TFBR        (*(volatile uint32_t*)(VI_BASE + 0x20))  // Top Field Base Right
#define VI_BFBL        (*(volatile uint32_t*)(VI_BASE + 0x24))  // Bottom Field Base Left
#define VI_BFBR        (*(volatile uint32_t*)(VI_BASE + 0x28))  // Bottom Field Base Right
#define VI_DPV         (*(volatile uint16_t*)(VI_BASE + 0x2C))  // Display Position Vertical
#define VI_DPH         (*(volatile uint16_t*)(VI_BASE + 0x2E))  // Display Position Horizontal
#define VI_DI0         (*(volatile uint32_t*)(VI_BASE + 0x30))  // Display Interrupt 0
#define VI_DI1         (*(volatile uint32_t*)(VI_BASE + 0x34))  // Display Interrupt 1
#define VI_DI2         (*(volatile uint32_t*)(VI_BASE + 0x38))  // Display Interrupt 2
#define VI_DI3         (*(volatile uint32_t*)(VI_BASE + 0x3C))  // Display Interrupt 3
#define VI_DL0         (*(volatile uint32_t*)(VI_BASE + 0x40))  // Display Latch 0
#define VI_DL1         (*(volatile uint32_t*)(VI_BASE + 0x44))  // Display Latch 1
#define VI_HSW         (*(volatile uint16_t*)(VI_BASE + 0x48))  // Horizontal Scaling Width
#define VI_HSR         (*(volatile uint16_t*)(VI_BASE + 0x4A))  // Horizontal Scaling Step
#define VI_FCT0        (*(volatile uint32_t*)(VI_BASE + 0x4C))  // Filter Coefficient Table 0
#define VI_FCT1        (*(volatile uint32_t*)(VI_BASE + 0x50))  // Filter Coefficient Table 1
#define VI_FCT2        (*(volatile uint32_t*)(VI_BASE + 0x54))  // Filter Coefficient Table 2
#define VI_FCT3        (*(volatile uint32_t*)(VI_BASE + 0x58))  // Filter Coefficient Table 3
#define VI_FCT4        (*(volatile uint32_t*)(VI_BASE + 0x5C))  // Filter Coefficient Table 4
#define VI_FCT5        (*(volatile uint32_t*)(VI_BASE + 0x60))  // Filter Coefficient Table 5
#define VI_FCT6        (*(volatile uint32_t*)(VI_BASE + 0x64))  // Filter Coefficient Table 6
#define VI_VISEL       (*(volatile uint16_t*)(VI_BASE + 0x6E))  // VI Select

/* VI Timing values for NTSC and PAL */
#define VI_NTSC         0
#define VI_PAL          1
#define VI_MPAL         2
#define VI_DEBUG        3

/* XFB (External Frame Buffer) parameters */
#define XFB_WIDTH       640
#define XFB_HEIGHT_NTSC 480
#define XFB_HEIGHT_PAL  574

/* Static XFB buffer - 640x480 YUV (2 bytes per pixel) */
static uint8_t g_xfb[XFB_WIDTH * XFB_HEIGHT_NTSC * 2] __attribute__((aligned(32)));
static int g_vi_initialized = 0;

/* ============================================================================
 * 8x8 Bitmap Font (ASCII 32-127)
 * ========================================================================= */

static const uint8_t font_8x8[96][8] = {
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* 'Report(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* VI register base */
#define VI_BASE 0xCC002000

/* Simple 8x8 monospace font for ASCII 0x20-0x7F */
static const uint8_t font_8x8[96][8] = {
    /* Space through ~ */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* '$' */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    /* Remaining characters simplified for space */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* '[' - ']' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* 'a' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
};

/* Minimal VI text rendering */
static void draw_text_vi(const char* text) {
    /* Ultra-minimal: just try to init VI and draw text */
    /* In real implementation, would setup XFB properly */
    /* This is a stub - full VI init is complex */
    (void)text; /* Suppress warning */
    
    /* TODO: Full VI/XFB initialization if OSReport unavailable */
    /* For size budget, we skip full implementation */
}

void dh_banner(void) {
    /* Try OSReport first */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Fallback: minimal VI rendering */
    draw_text_vi("Patched with DolHook");
}

#endif /* DOLHOOK_NO_BANNER */ */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    {0x1E,0x06,0x06,0x06,0x06,0x06,0x1E,0x00}, /* '[' */
    {0x03,0x06,0x0C,0x18,0x30,0x60,0x40,0x00}, /* '\' */
    {0x1E,0x18,0x18,0x18,0x18,0x18,0x1E,0x00}, /* ']' */
    {0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00}, /* '^' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF}, /* '_' */
    {0x0C,0x0C,0x18,0x00,0x00,0x00,0x00,0x00}, /* '`' */
    {0x00,0x00,0x1E,0x30,0x3E,0x33,0x6E,0x00}, /* 'a' */
    {0x07,0x06,0x06,0x3E,0x66,0x66,0x3B,0x00}, /* 'b' */
    {0x00,0x00,0x1E,0x33,0x03,0x33,0x1E,0x00}, /* 'c' */
    {0x38,0x30,0x30,0x3e,0x33,0x33,0x6E,0x00}, /* 'd' */
    {0x00,0x00,0x1E,0x33,0x3f,0x03,0x1E,0x00}, /* 'e' */
    {0x1C,0x36,0x06,0x0f,0x06,0x06,0x0F,0x00}, /* 'f' */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x1F}, /* 'g' */
    {0x07,0x06,0x36,0x6E,0x66,0x66,0x67,0x00}, /* 'h' */
    {0x0C,0x00,0x0E,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'i' */
    {0x30,0x00,0x30,0x30,0x30,0x33,0x33,0x1E}, /* 'j' */
    {0x07,0x06,0x66,0x36,0x1E,0x36,0x67,0x00}, /* 'k' */
    {0x0E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'l' */
    {0x00,0x00,0x33,0x7F,0x7F,0x6B,0x63,0x00}, /* 'm' */
    {0x00,0x00,0x1F,0x33,0x33,0x33,0x33,0x00}, /* 'n' */
    {0x00,0x00,0x1E,0x33,0x33,0x33,0x1E,0x00}, /* 'o' */
    {0x00,0x00,0x3B,0x66,0x66,0x3E,0x06,0x0F}, /* 'p' */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x78}, /* 'q' */
    {0x00,0x00,0x3B,0x6E,0x66,0x06,0x0F,0x00}, /* 'r' */
    {0x00,0x00,0x3E,0x03,0x1E,0x30,0x1F,0x00}, /* 's' */
    {0x08,0x0C,0x3E,0x0C,0x0C,0x2C,0x18,0x00}, /* 't' */
    {0x00,0x00,0x33,0x33,0x33,0x33,0x6E,0x00}, /* 'u' */
    {0x00,0x00,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'v' */
    {0x00,0x00,0x63,0x6B,0x7F,0x7F,0x36,0x00}, /* 'w' */
    {0x00,0x00,0x63,0x36,0x1C,0x36,0x63,0x00}, /* 'x' */
    {0x00,0x00,0x33,0x33,0x33,0x3E,0x30,0x1F}, /* 'y' */
    {0x00,0x00,0x3F,0x19,0x0C,0x26,0x3F,0x00}, /* 'z' */
    {0x38,0x0C,0x0C,0x07,0x0C,0x0C,0x38,0x00}, /* '{' */
    {0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00}, /* '|' */
    {0x07,0x0C,0x0C,0x38,0x0C,0x0C,0x07,0x00}, /* '}' */
    {0x6E,0x3B,0x00,0x00,0x00,0x00,0x00,0x00}, /* '~' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}  /* DEL */
};

/* ============================================================================
 * VI Timing Configuration
 * ========================================================================= */

typedef struct {
    uint16_t vtr;
    uint16_t dcr;
    uint32_t htr0;
    uint32_t htr1;
    uint32_t vto;
    uint32_t vte;
    uint32_t bboi;
    uint32_t bbei;
    uint16_t hsr;
    uint16_t width;
    uint16_t height;
} vi_config;

/* NTSC 480i configuration */
static const vi_config ntsc_config = {
    .vtr = 0x0F06,          // Vertical timing: 262 lines per field
    .dcr = 0x11F0,          // Display config: interlaced, 16-bit RGB565
    .htr0 = 0x01AD0150,     // Horizontal timing
    .htr1 = 0x00C3012C,
    .vto = 0x00060030,      // Vertical timing odd
    .vte = 0x00060030,      // Vertical timing even
    .bboi = 0x005B0122,     // Burst blanking odd
    .bbei = 0x005B0122,     // Burst blanking even
    .hsr = 0x0280,          // Horizontal scale: 640 pixels
    .width = 640,
    .height = 480
};

/* PAL 574i configuration */
static const vi_config pal_config = {
    .vtr = 0x1106,          // Vertical timing: 312 lines per field
    .dcr = 0x01F0,          // Display config: PAL
    .htr0 = 0x01AD01B4,     // Horizontal timing
    .htr1 = 0x00C5014C,
    .vto = 0x00120038,      // Vertical timing odd
    .vte = 0x00120038,      // Vertical timing even
    .bboi = 0x005B0142,     // Burst blanking odd
    .bbei = 0x005B0142,     // Burst blanking even
    .hsr = 0x0280,          // Horizontal scale
    .width = 640,
    .height = 574
};

/* ============================================================================
 * VI Detection and Initialization
 * ========================================================================= */

static int detect_video_mode(void) {
    /* Read VTR register to detect mode */
    uint16_t vtr = VI_VTR;
    
    /* NTSC: typically 0x0F06 (262 lines)
     * PAL:  typically 0x1106 (312 lines) */
    if ((vtr & 0xFF00) == 0x1100) {
        return VI_PAL;
    }
    
    /* Default to NTSC */
    return VI_NTSC;
}

static void vi_init_hardware(const vi_config* cfg) {
    /* Disable display during reconfiguration */
    VI_DCR = 0;
    
    /* Configure timing */
    VI_VTR = cfg->vtr;
    VI_HTR0 = cfg->htr0;
    VI_HTR1 = cfg->htr1;
    VI_VTO = cfg->vto;
    VI_VTE = cfg->vte;
    VI_BBOI = cfg->bboi;
    VI_BBEI = cfg->bbei;
    
    /* Set framebuffer addresses (same for top/bottom since we're progressive) */
    uint32_t xfb_addr = ((uint32_t)g_xfb) & 0x3FFFFFFF; // Physical address
    VI_TFBL = xfb_addr;
    VI_TFBR = xfb_addr;
    VI_BFBL = xfb_addr;
    VI_BFBR = xfb_addr;
    
    /* Set display position (centered) */
    VI_DPH = 0x0028;        // Horizontal position
    VI_DPV = 0x0018;        // Vertical position
    
    /* Configure horizontal scaling */
    VI_HSW = cfg->width;
    VI_HSR = cfg->hsr;
    
    /* Setup anti-aliasing filter coefficients (default: no filtering) */
    VI_FCT0 = 0x00000000;
    VI_FCT1 = 0x00000000;
    VI_FCT2 = 0x00000000;
    VI_FCT3 = 0x00000000;
    VI_FCT4 = 0x00000000;
    VI_FCT5 = 0x00000000;
    VI_FCT6 = 0x00000000;
    
    /* Enable display */
    VI_DCR = cfg->dcr;
    
    /* Flush CPU cache for XFB */
    asm volatile(
        "lis 3, g_xfb@ha\n"
        "addi 3, 3, g_xfb@l\n"
        "li 4, %0\n"
        "1:\n"
        "dcbf 0, 3\n"
        "addi 3, 3, 32\n"
        "addic. 4, 4, -32\n"
        "bgt 1b\n"
        "sync\n"
        : : "i"(sizeof(g_xfb)) : "r3", "r4", "memory"
    );
}

static void clear_xfb(void) {
    /* YUV black: Y=16, U=128, V=128 (BT.601)
     * In YUY2 format: Y0 U Y1 V (4 bytes per 2 pixels) */
    uint32_t* xfb32 = (uint32_t*)g_xfb;
    uint32_t black_yuv = 0x10801080; // Y=16, UV=128 for both pixels
    
    size_t words = (XFB_WIDTH * XFB_HEIGHT_NTSC * 2) / 4;
    for (size_t i = 0; i < words; i++) {
        xfb32[i] = black_yuv;
    }
}

/* ============================================================================
 * Text Rendering (YUV framebuffer)
 * ========================================================================= */

static void draw_char(int x, int y, char c) {
    if (c < 32 || c > 126) return;
    
    const uint8_t* glyph = font_8x8[c - 32];
    
    /* YUV white: Y=235, U=128, V=128
     * Each pixel pair in YUY2: Y0 U Y1 V */
    for (int row = 0; row < 8; row++) {
        uint8_t line = glyph[row];
        
        for (int col = 0; col < 8; col += 2) {
            int px = x + col;
            int py = y + row;
            
            if (px >= XFB_WIDTH - 1 || py >= XFB_HEIGHT_NTSC) continue;
            
            /* YUY2 format: each 4 bytes = 2 pixels */
            int offset = (py * XFB_WIDTH + px) * 2;
            
            uint8_t bit0 = (line >> (7 - col)) & 1;
            uint8_t bit1 = (line >> (6 - col)) & 1;
            
            /* Y0 */
            g_xfb[offset + 0] = bit0 ? 235 : 16;
            /* U (shared) */
            g_xfb[offset + 1] = 128;
            /* Y1 */
            g_xfb[offset + 2] = bit1 ? 235 : 16;
            /* V (shared) */
            g_xfb[offset + 3] = 128;
        }
    }
}

static void draw_text(int x, int y, const char* text) {
    int cursor_x = x;
    
    while (*text) {
        if (*text == '\n') {
            cursor_x = x;
            y += 8;
        } else {
            draw_char(cursor_x, y, *text);
            cursor_x += 8;
        }
        text++;
    }
}

/* ============================================================================
 * Public Banner Function
 * ========================================================================= */

void dh_banner(void) {
    /* Try OSReport first (fastest path) */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Initialize VI if not already done */
    if (!g_vi_initialized) {
        /* Detect video mode */
        int mode = detect_video_mode();
        const vi_config* cfg = (mode == VI_PAL) ? &pal_config : &ntsc_config;
        
        /* Initialize hardware */
        vi_init_hardware(cfg);
        
        /* Clear framebuffer to black */
        clear_xfb();
        
        g_vi_initialized = 1;
    }
    
    /* Draw banner text at top-left with small margin */
    draw_text(16, 16, "Patched with DolHook");
    
    /* Flush cache for the affected region */
    asm volatile(
        "lis 3, g_xfb@ha\n"
        "addi 3, 3, g_xfb@l\n"
        "li 4, 4096\n"      // Flush first 4KB (more than enough for text)
        "1:\n"
        "dcbf 0, 3\n"
        "addi 3, 3, 32\n"
        "addic. 4, 4, -32\n"
        "bgt 1b\n"
        "sync\n"
        : : : "r3", "r4", "memory"
    );
}

#endif /* DOLHOOK_NO_BANNER */Report(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* VI register base */
#define VI_BASE 0xCC002000

/* Simple 8x8 monospace font for ASCII 0x20-0x7F */
static const uint8_t font_8x8[96][8] = {
    /* Space through ~ */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* '$' */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    /* Remaining characters simplified for space */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* '[' - ']' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* 'a' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
};

/* Minimal VI text rendering */
static void draw_text_vi(const char* text) {
    /* Ultra-minimal: just try to init VI and draw text */
    /* In real implementation, would setup XFB properly */
    /* This is a stub - full VI init is complex */
    (void)text; /* Suppress warning */
    
    /* TODO: Full VI/XFB initialization if OSReport unavailable */
    /* For size budget, we skip full implementation */
}

void dh_banner(void) {
    /* Try OSReport first */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Fallback: minimal VI rendering */
    draw_text_vi("Patched with DolHook");
}

#endif /* DOLHOOK_NO_BANNER */ 36 */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' 37 */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' 38 */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' 39 */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' 40 */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' 41 */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' 42 */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' 43 */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' 44 */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' 45 */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' 46 */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' 47 */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' 48 */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' 49 */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' 50 */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' 51 */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' 52 */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' 53 */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' 54 */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' 55 */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' 56 */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' 57 */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' 58 */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' 59 */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' 60 */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' 61 */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' 62 */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' 63 */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' 64 */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' 65 */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' 66 */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' 67 */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' 68 */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' 69 */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' 70 */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' 71 */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' 72 */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' 73 */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' 74 */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' 75 */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' 76 */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' 77 */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' 78 */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' 79 */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' 80 */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' 81 */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' 82 */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' 83 */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' 84 */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' 85 */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' 86 */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' 87 */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' 88 */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' 89 */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' 90 */
    {0x1E,0x06,0x06,0x06,0x06,0x06,0x1E,0x00}, /* '[' 91 */
    {0x03,0x06,0x0C,0x18,0x30,0x60,0x40,0x00}, /* '\' 92 */
    {0x1E,0x18,0x18,0x18,0x18,0x18,0x1E,0x00}, /* ']' 93 */
    {0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00}, /* '^' 94 */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF}, /* '_' 95 */
    {0x0C,0x0C,0x18,0x00,0x00,0x00,0x00,0x00}, /* '`' 96 */
    {0x00,0x00,0x1E,0x30,0x3E,0x33,0x6E,0x00}, /* 'a' 97 */
    {0x07,0x06,0x06,0x3E,0x66,0x66,0x3B,0x00}, /* 'b' 98 */
    {0x00,0x00,0x1E,0x33,0x03,0x33,0x1E,0x00}, /* 'c' 99 */
    {0x38,0x30,0x30,0x3E,0x33,0x33,0x6E,0x00}, /* 'd' 100 */
    {0x00,0x00,0x1E,0x33,0x3F,0x03,0x1E,0x00}, /* 'e' 101 */
    {0x1C,0x36,0x06,0x0F,0x06,0x06,0x0F,0x00}, /* 'f' 102 */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x1F}, /* 'g' 103 */
    {0x07,0x06,0x36,0x6E,0x66,0x66,0x67,0x00}, /* 'h' 104 */
    {0x0C,0x00,0x0E,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'i' 105 */
    {0x30,0x00,0x30,0x30,0x30,0x33,0x33,0x1E}, /* 'j' 106 */
    {0x07,0x06,0x66,0x36,0x1E,0x36,0x67,0x00}, /* 'k' 107 */
    {0x0E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'l' 108 */
    {0x00,0x00,0x33,0x7F,0x7F,0x6B,0x63,0x00}, /* 'm' 109 */
    {0x00,0x00,0x1F,0x33,0x33,0x33,0x33,0x00}, /* 'n' 110 */
    {0x00,0x00,0x1E,0x33,0x33,0x33,0x1E,0x00}, /* 'o' 111 */
    {0x00,0x00,0x3B,0x66,0x66,0x3E,0x06,0x0F}, /* 'p' 112 */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x78}, /* 'q' 113 */
    {0x00,0x00,0x3B,0x6E,0x66,0x06,0x0F,0x00}, /* 'r' 114 */
    {0x00,0x00,0x3E,0x03,0x1E,0x30,0x1F,0x00}, /* 's' 115 */
    {0x08,0x0C,0x3E,0x0C,0x0C,0x2C,0x18,0x00}, /* 't' 116 */
    {0x00,0x00,0x33,0x33,0x33,0x33,0x6E,0x00}, /* 'u' 117 */
    {0x00,0x00,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'v' 118 */
    {0x00,0x00,0x63,0x6B,0x7F,0x7F,0x36,0x00}, /* 'w' 119 */
    {0x00,0x00,0x63,0x36,0x1C,0x36,0x63,0x00}, /* 'x' 120 */
    {0x00,0x00,0x33,0x33,0x33,0x3E,0x30,0x1F}, /* 'y' 121 */
    {0x00,0x00,0x3F,0x19,0x0C,0x26,0x3F,0x00}, /* 'z' 122 */
    {0x38,0x0C,0x0C,0x07,0x0C,0x0C,0x38,0x00}, /* '{' 123 */
    {0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00}, /* '|' 124 */
    {0x07,0x0C,0x0C,0x38,0x0C,0x0C,0x07,0x00}, /* '}' 125 */
    {0x6E,0x3B,0x00,0x00,0x00,0x00,0x00,0x00}, /* '~' 126 */
};

/* ============================================================================
 * VI Timing Configuration Structures
 * ========================================================================= */

typedef struct {
    uint16_t vtr;      /* Vertical Timing Register */
    uint16_t dcr;      /* Display Configuration Register */
    uint32_t htr0;     /* Horizontal Timing 0 */
    uint32_t htr1;     /* Horizontal Timing 1 */
    uint32_t vto;      /* Vertical Timing Odd */
    uint32_t vte;      /* Vertical Timing Even */
    uint32_t bboi;     /* Burst Blanking Odd Interval */
    uint32_t bbei;     /* Burst Blanking Even Interval */
    uint16_t dpv;      /* Display Position Vertical */
    uint16_t dph;      /* Display Position Horizontal */
    uint16_t hsw;      /* Horizontal Scaling Width */
    uint16_t hsr;      /* Horizontal Scaling Ratio */
    uint16_t hbe640;   /* Horizontal Back End (640 mode) */
    uint16_t hbs640;   /* Horizontal Back Start (640 mode) */
    uint16_t width;
    uint16_t height;
} vi_timing_config;

/* NTSC 480i Timing (59.94 Hz) */
static const vi_timing_config ntsc_480i_config = {
    .vtr = 0x0F06,          /* 262 lines per field, 6 EQU pulses */
    .dcr = 0x01F0,          /* Enable display, interlaced, 16-bit, NTSC */
    .htr0 = 0x01AD0150,     /* H-timing: Half-line 429, EQU 336 */
    .htr1 = 0x00C3012C,     /* H-blank: start 195, end 300 */
    .vto = 0x00060030,      /* V-timing odd: pre 6, post 48 */
    .vte = 0x00060030,      /* V-timing even: pre 6, post 48 */
    .bboi = 0x005B0122,     /* Burst blanking odd: line 91-290 */
    .bbei = 0x005B0122,     /* Burst blanking even: line 91-290 */
    .dpv = 0x0018,          /* Display position V: 24 */
    .dph = 0x0028,          /* Display position H: 40 */
    .hsw = 640,             /* Horizontal scale width */
    .hsr = 0x0280,          /* Horizontal scale ratio (1:1) */
    .hbe640 = 0x00C7,       /* H-back end */
    .hbs640 = 0x0027,       /* H-back start */
    .width = 640,
    .height = 480
};

/* PAL 576i Timing (50 Hz) */
static const vi_timing_config pal_576i_config = {
    .vtr = 0x1106,          /* 312 lines per field, 6 EQU pulses */
    .dcr = 0x01F0,          /* Enable display, interlaced, 16-bit, PAL */
    .htr0 = 0x01AD01B4,     /* H-timing: Half-line 429, EQU 436 */
    .htr1 = 0x00C5014C,     /* H-blank: start 197, end 332 */
    .vto = 0x00120038,      /* V-timing odd: pre 18, post 56 */
    .vte = 0x00120038,      /* V-timing even: pre 18, post 56 */
    .bboi = 0x005B0142,     /* Burst blanking odd: line 91-322 */
    .bbei = 0x005B0142,     /* Burst blanking even: line 91-322 */
    .dpv = 0x0023,          /* Display position V: 35 */
    .dph = 0x0028,          /* Display position H: 40 */
    .hsw = 640,             /* Horizontal scale width */
    .hsr = 0x0280,          /* Horizontal scale ratio (1:1) */
    .hbe640 = 0x00D7,       /* H-back end */
    .hbs640 = 0x0027,       /* H-back start */
    .width = 640,
    .height = 574
};

/* ============================================================================
 * Video Mode Detection
 * ========================================================================= */

static int detect_video_mode(void) {
    /* Read current VTR to detect mode */
    uint16_t vtr = VI_VTR;
    
    /* Check lines per field:
     * NTSC: 262 lines (0x0F06 typical)
     * PAL:  312 lines (0x1106 typical) */
    if ((vtr & 0xFF00) >= 0x1100) {
        return VI_PAL;
    }
    
    /* Default to NTSC for North America/Japan */
    return VI_NTSC;
}

/* ============================================================================
 * VI Hardware Initialization
 * ========================================================================= */

static void vi_configure_hardware(const vi_timing_config* cfg) {
    /* Step 1: Disable display during reconfiguration */
    VI_DCR = 0x0000;
    
    /* Step 2: Configure timing registers */
    VI_VTR = cfg->vtr;
    VI_HTR0 = cfg->htr0;
    VI_HTR1 = cfg->htr1;
    VI_VTO = cfg->vto;
    VI_VTE = cfg->vte;
    VI_BBOI = cfg->bboi;
    VI_BBEI = cfg->bbei;
    
    /* Step 3: Set framebuffer addresses (convert to physical address) */
    uint32_t xfb_phys = ((uint32_t)g_xfb) & 0x3FFFFFFF;
    
    VI_TFBL = xfb_phys;     /* Top field base left */
    VI_TFBR = xfb_phys;     /* Top field base right (same for non-3D) */
    VI_BFBL = xfb_phys;     /* Bottom field base left (progressive) */
    VI_BFBR = xfb_phys;     /* Bottom field base right */
    
    /* Step 4: Configure display position (center on screen) */
    VI_DPV = cfg->dpv;
    VI_DPH = cfg->dph;
    
    /* Step 5: Configure horizontal scaling */
    VI_HSW = cfg->hsw;
    VI_HSR = cfg->hsr;
    VI_HBE = cfg->hbe640;
    VI_HBS = cfg->hbs640;
    
    /* Step 6: Configure anti-aliasing filter (disable for sharp text) */
    VI_FCT0 = 0x00000000;   /* Filter coefficients: pass-through */
    VI_FCT1 = 0x00000000;
    VI_FCT2 = 0x01000000;   /* Main tap = 1.0 */
    VI_FCT3 = 0x00000000;
    VI_FCT4 = 0x00000000;
    VI_FCT5 = 0x00000000;
    VI_FCT6 = 0x00000000;
    
    /* Step 7: Disable anti-aliasing in AA register */
    VI_AA = 0x0000;
    
    /* Step 8: Configure clock and select */
    VI_VICLK = 0x0000;      /* Use default VI clock */
    VI_VISEL = 0x0001;      /* Select progressive mode */
    
    /* Step 9: Clear display interrupts */
    VI_DI0 = 0x00000000;
    VI_DI1 = 0x00000000;
    VI_DI2 = 0x00000000;
    VI_DI3 = 0x00000000;
    
    /* Step 10: Enable display with final configuration */
    VI_DCR = cfg->dcr;
    
    /* Step 11: Flush XFB from CPU cache so VI DMA can see it */
    asm volatile(
        "lis 3, g_xfb@ha\n"
        "addi 3, 3, g_xfb@l\n"
        "li 4, %0\n"
        "1:\n"
        "dcbf 0, 3\n"           /* Data cache block flush */
        "addi 3, 3, 32\n"       /* Next cache line (32 bytes) */
        "addic. 4, 4, -32\n"
        "bgt 1b\n"
        "sync\n"                /* Ensure flushes complete */
        : : "i"(sizeof(g_xfb)) : "r3", "r4", "memory"
    );
}

/* ============================================================================
 * XFB (External Frame Buffer) Management
 * ========================================================================= */

/**
 * Clear entire XFB to black (Y=16, U=128, V=128)
 * YUY2 format: Y0 U Y1 V (4 bytes per 2 pixels)
 */
static void xfb_clear(void) {
    uint32_t* xfb32 = (uint32_t*)g_xfb;
    uint32_t black_yuv = 0x10801080;  /* Y=16, U=128, Y=16, V=128 */
    
    /* Fill entire buffer with black/**
 * DolHook Banner Display
 * Full VI (Video Interface) initialization and text rendering
 */

#include "dolhook.h"
#include <string.h>

extern void OSReport(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* ============================================================================
 * VI Hardware Registers
 * ========================================================================= */

#define VI_BASE 0xCC002000

/* VI Register offsets */
#define VI_VTR          (*(volatile uint16_t*)(VI_BASE + 0x00))  // Vertical Timing
#define VI_DCR          (*(volatile uint16_t*)(VI_BASE + 0x02))  // Display Configuration
#define VI_HTR0         (*(volatile uint32_t*)(VI_BASE + 0x04))  // Horizontal Timing 0
#define VI_HTR1         (*(volatile uint32_t*)(VI_BASE + 0x08))  // Horizontal Timing 1
#define VI_VTO         (*(volatile uint32_t*)(VI_BASE + 0x0C))  // Vertical Timing Odd
#define VI_VTE         (*(volatile uint32_t*)(VI_BASE + 0x10))  // Vertical Timing Even
#define VI_BBOI        (*(volatile uint32_t*)(VI_BASE + 0x14))  // Burst Blanking Odd Interval
#define VI_BBEI        (*(volatile uint32_t*)(VI_BASE + 0x18))  // Burst Blanking Even Interval
#define VI_TFBL        (*(volatile uint32_t*)(VI_BASE + 0x1C))  // Top Field Base Left
#define VI_TFBR        (*(volatile uint32_t*)(VI_BASE + 0x20))  // Top Field Base Right
#define VI_BFBL        (*(volatile uint32_t*)(VI_BASE + 0x24))  // Bottom Field Base Left
#define VI_BFBR        (*(volatile uint32_t*)(VI_BASE + 0x28))  // Bottom Field Base Right
#define VI_DPV         (*(volatile uint16_t*)(VI_BASE + 0x2C))  // Display Position Vertical
#define VI_DPH         (*(volatile uint16_t*)(VI_BASE + 0x2E))  // Display Position Horizontal
#define VI_DI0         (*(volatile uint32_t*)(VI_BASE + 0x30))  // Display Interrupt 0
#define VI_DI1         (*(volatile uint32_t*)(VI_BASE + 0x34))  // Display Interrupt 1
#define VI_DI2         (*(volatile uint32_t*)(VI_BASE + 0x38))  // Display Interrupt 2
#define VI_DI3         (*(volatile uint32_t*)(VI_BASE + 0x3C))  // Display Interrupt 3
#define VI_DL0         (*(volatile uint32_t*)(VI_BASE + 0x40))  // Display Latch 0
#define VI_DL1         (*(volatile uint32_t*)(VI_BASE + 0x44))  // Display Latch 1
#define VI_HSW         (*(volatile uint16_t*)(VI_BASE + 0x48))  // Horizontal Scaling Width
#define VI_HSR         (*(volatile uint16_t*)(VI_BASE + 0x4A))  // Horizontal Scaling Step
#define VI_FCT0        (*(volatile uint32_t*)(VI_BASE + 0x4C))  // Filter Coefficient Table 0
#define VI_FCT1        (*(volatile uint32_t*)(VI_BASE + 0x50))  // Filter Coefficient Table 1
#define VI_FCT2        (*(volatile uint32_t*)(VI_BASE + 0x54))  // Filter Coefficient Table 2
#define VI_FCT3        (*(volatile uint32_t*)(VI_BASE + 0x58))  // Filter Coefficient Table 3
#define VI_FCT4        (*(volatile uint32_t*)(VI_BASE + 0x5C))  // Filter Coefficient Table 4
#define VI_FCT5        (*(volatile uint32_t*)(VI_BASE + 0x60))  // Filter Coefficient Table 5
#define VI_FCT6        (*(volatile uint32_t*)(VI_BASE + 0x64))  // Filter Coefficient Table 6
#define VI_VISEL       (*(volatile uint16_t*)(VI_BASE + 0x6E))  // VI Select

/* VI Timing values for NTSC and PAL */
#define VI_NTSC         0
#define VI_PAL          1
#define VI_MPAL         2
#define VI_DEBUG        3

/* XFB (External Frame Buffer) parameters */
#define XFB_WIDTH       640
#define XFB_HEIGHT_NTSC 480
#define XFB_HEIGHT_PAL  574

/* Static XFB buffer - 640x480 YUV (2 bytes per pixel) */
static uint8_t g_xfb[XFB_WIDTH * XFB_HEIGHT_NTSC * 2] __attribute__((aligned(32)));
static int g_vi_initialized = 0;

/* ============================================================================
 * 8x8 Bitmap Font (ASCII 32-127)
 * ========================================================================= */

static const uint8_t font_8x8[96][8] = {
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* 'Report(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* VI register base */
#define VI_BASE 0xCC002000

/* Simple 8x8 monospace font for ASCII 0x20-0x7F */
static const uint8_t font_8x8[96][8] = {
    /* Space through ~ */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* '$' */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    /* Remaining characters simplified for space */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* '[' - ']' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* 'a' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
};

/* Minimal VI text rendering */
static void draw_text_vi(const char* text) {
    /* Ultra-minimal: just try to init VI and draw text */
    /* In real implementation, would setup XFB properly */
    /* This is a stub - full VI init is complex */
    (void)text; /* Suppress warning */
    
    /* TODO: Full VI/XFB initialization if OSReport unavailable */
    /* For size budget, we skip full implementation */
}

void dh_banner(void) {
    /* Try OSReport first */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Fallback: minimal VI rendering */
    draw_text_vi("Patched with DolHook");
}

#endif /* DOLHOOK_NO_BANNER */ */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    {0x1E,0x06,0x06,0x06,0x06,0x06,0x1E,0x00}, /* '[' */
    {0x03,0x06,0x0C,0x18,0x30,0x60,0x40,0x00}, /* '\' */
    {0x1E,0x18,0x18,0x18,0x18,0x18,0x1E,0x00}, /* ']' */
    {0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00}, /* '^' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF}, /* '_' */
    {0x0C,0x0C,0x18,0x00,0x00,0x00,0x00,0x00}, /* '`' */
    {0x00,0x00,0x1E,0x30,0x3E,0x33,0x6E,0x00}, /* 'a' */
    {0x07,0x06,0x06,0x3E,0x66,0x66,0x3B,0x00}, /* 'b' */
    {0x00,0x00,0x1E,0x33,0x03,0x33,0x1E,0x00}, /* 'c' */
    {0x38,0x30,0x30,0x3e,0x33,0x33,0x6E,0x00}, /* 'd' */
    {0x00,0x00,0x1E,0x33,0x3f,0x03,0x1E,0x00}, /* 'e' */
    {0x1C,0x36,0x06,0x0f,0x06,0x06,0x0F,0x00}, /* 'f' */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x1F}, /* 'g' */
    {0x07,0x06,0x36,0x6E,0x66,0x66,0x67,0x00}, /* 'h' */
    {0x0C,0x00,0x0E,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'i' */
    {0x30,0x00,0x30,0x30,0x30,0x33,0x33,0x1E}, /* 'j' */
    {0x07,0x06,0x66,0x36,0x1E,0x36,0x67,0x00}, /* 'k' */
    {0x0E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'l' */
    {0x00,0x00,0x33,0x7F,0x7F,0x6B,0x63,0x00}, /* 'm' */
    {0x00,0x00,0x1F,0x33,0x33,0x33,0x33,0x00}, /* 'n' */
    {0x00,0x00,0x1E,0x33,0x33,0x33,0x1E,0x00}, /* 'o' */
    {0x00,0x00,0x3B,0x66,0x66,0x3E,0x06,0x0F}, /* 'p' */
    {0x00,0x00,0x6E,0x33,0x33,0x3E,0x30,0x78}, /* 'q' */
    {0x00,0x00,0x3B,0x6E,0x66,0x06,0x0F,0x00}, /* 'r' */
    {0x00,0x00,0x3E,0x03,0x1E,0x30,0x1F,0x00}, /* 's' */
    {0x08,0x0C,0x3E,0x0C,0x0C,0x2C,0x18,0x00}, /* 't' */
    {0x00,0x00,0x33,0x33,0x33,0x33,0x6E,0x00}, /* 'u' */
    {0x00,0x00,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'v' */
    {0x00,0x00,0x63,0x6B,0x7F,0x7F,0x36,0x00}, /* 'w' */
    {0x00,0x00,0x63,0x36,0x1C,0x36,0x63,0x00}, /* 'x' */
    {0x00,0x00,0x33,0x33,0x33,0x3E,0x30,0x1F}, /* 'y' */
    {0x00,0x00,0x3F,0x19,0x0C,0x26,0x3F,0x00}, /* 'z' */
    {0x38,0x0C,0x0C,0x07,0x0C,0x0C,0x38,0x00}, /* '{' */
    {0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00}, /* '|' */
    {0x07,0x0C,0x0C,0x38,0x0C,0x0C,0x07,0x00}, /* '}' */
    {0x6E,0x3B,0x00,0x00,0x00,0x00,0x00,0x00}, /* '~' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}  /* DEL */
};

/* ============================================================================
 * VI Timing Configuration
 * ========================================================================= */

typedef struct {
    uint16_t vtr;
    uint16_t dcr;
    uint32_t htr0;
    uint32_t htr1;
    uint32_t vto;
    uint32_t vte;
    uint32_t bboi;
    uint32_t bbei;
    uint16_t hsr;
    uint16_t width;
    uint16_t height;
} vi_config;

/* NTSC 480i configuration */
static const vi_config ntsc_config = {
    .vtr = 0x0F06,          // Vertical timing: 262 lines per field
    .dcr = 0x11F0,          // Display config: interlaced, 16-bit RGB565
    .htr0 = 0x01AD0150,     // Horizontal timing
    .htr1 = 0x00C3012C,
    .vto = 0x00060030,      // Vertical timing odd
    .vte = 0x00060030,      // Vertical timing even
    .bboi = 0x005B0122,     // Burst blanking odd
    .bbei = 0x005B0122,     // Burst blanking even
    .hsr = 0x0280,          // Horizontal scale: 640 pixels
    .width = 640,
    .height = 480
};

/* PAL 574i configuration */
static const vi_config pal_config = {
    .vtr = 0x1106,          // Vertical timing: 312 lines per field
    .dcr = 0x01F0,          // Display config: PAL
    .htr0 = 0x01AD01B4,     // Horizontal timing
    .htr1 = 0x00C5014C,
    .vto = 0x00120038,      // Vertical timing odd
    .vte = 0x00120038,      // Vertical timing even
    .bboi = 0x005B0142,     // Burst blanking odd
    .bbei = 0x005B0142,     // Burst blanking even
    .hsr = 0x0280,          // Horizontal scale
    .width = 640,
    .height = 574
};

/* ============================================================================
 * VI Detection and Initialization
 * ========================================================================= */

static int detect_video_mode(void) {
    /* Read VTR register to detect mode */
    uint16_t vtr = VI_VTR;
    
    /* NTSC: typically 0x0F06 (262 lines)
     * PAL:  typically 0x1106 (312 lines) */
    if ((vtr & 0xFF00) == 0x1100) {
        return VI_PAL;
    }
    
    /* Default to NTSC */
    return VI_NTSC;
}

static void vi_init_hardware(const vi_config* cfg) {
    /* Disable display during reconfiguration */
    VI_DCR = 0;
    
    /* Configure timing */
    VI_VTR = cfg->vtr;
    VI_HTR0 = cfg->htr0;
    VI_HTR1 = cfg->htr1;
    VI_VTO = cfg->vto;
    VI_VTE = cfg->vte;
    VI_BBOI = cfg->bboi;
    VI_BBEI = cfg->bbei;
    
    /* Set framebuffer addresses (same for top/bottom since we're progressive) */
    uint32_t xfb_addr = ((uint32_t)g_xfb) & 0x3FFFFFFF; // Physical address
    VI_TFBL = xfb_addr;
    VI_TFBR = xfb_addr;
    VI_BFBL = xfb_addr;
    VI_BFBR = xfb_addr;
    
    /* Set display position (centered) */
    VI_DPH = 0x0028;        // Horizontal position
    VI_DPV = 0x0018;        // Vertical position
    
    /* Configure horizontal scaling */
    VI_HSW = cfg->width;
    VI_HSR = cfg->hsr;
    
    /* Setup anti-aliasing filter coefficients (default: no filtering) */
    VI_FCT0 = 0x00000000;
    VI_FCT1 = 0x00000000;
    VI_FCT2 = 0x00000000;
    VI_FCT3 = 0x00000000;
    VI_FCT4 = 0x00000000;
    VI_FCT5 = 0x00000000;
    VI_FCT6 = 0x00000000;
    
    /* Enable display */
    VI_DCR = cfg->dcr;
    
    /* Flush CPU cache for XFB */
    asm volatile(
        "lis 3, g_xfb@ha\n"
        "addi 3, 3, g_xfb@l\n"
        "li 4, %0\n"
        "1:\n"
        "dcbf 0, 3\n"
        "addi 3, 3, 32\n"
        "addic. 4, 4, -32\n"
        "bgt 1b\n"
        "sync\n"
        : : "i"(sizeof(g_xfb)) : "r3", "r4", "memory"
    );
}

static void clear_xfb(void) {
    /* YUV black: Y=16, U=128, V=128 (BT.601)
     * In YUY2 format: Y0 U Y1 V (4 bytes per 2 pixels) */
    uint32_t* xfb32 = (uint32_t*)g_xfb;
    uint32_t black_yuv = 0x10801080; // Y=16, UV=128 for both pixels
    
    size_t words = (XFB_WIDTH * XFB_HEIGHT_NTSC * 2) / 4;
    for (size_t i = 0; i < words; i++) {
        xfb32[i] = black_yuv;
    }
}

/* ============================================================================
 * Text Rendering (YUV framebuffer)
 * ========================================================================= */

static void draw_char(int x, int y, char c) {
    if (c < 32 || c > 126) return;
    
    const uint8_t* glyph = font_8x8[c - 32];
    
    /* YUV white: Y=235, U=128, V=128
     * Each pixel pair in YUY2: Y0 U Y1 V */
    for (int row = 0; row < 8; row++) {
        uint8_t line = glyph[row];
        
        for (int col = 0; col < 8; col += 2) {
            int px = x + col;
            int py = y + row;
            
            if (px >= XFB_WIDTH - 1 || py >= XFB_HEIGHT_NTSC) continue;
            
            /* YUY2 format: each 4 bytes = 2 pixels */
            int offset = (py * XFB_WIDTH + px) * 2;
            
            uint8_t bit0 = (line >> (7 - col)) & 1;
            uint8_t bit1 = (line >> (6 - col)) & 1;
            
            /* Y0 */
            g_xfb[offset + 0] = bit0 ? 235 : 16;
            /* U (shared) */
            g_xfb[offset + 1] = 128;
            /* Y1 */
            g_xfb[offset + 2] = bit1 ? 235 : 16;
            /* V (shared) */
            g_xfb[offset + 3] = 128;
        }
    }
}

static void draw_text(int x, int y, const char* text) {
    int cursor_x = x;
    
    while (*text) {
        if (*text == '\n') {
            cursor_x = x;
            y += 8;
        } else {
            draw_char(cursor_x, y, *text);
            cursor_x += 8;
        }
        text++;
    }
}

/* ============================================================================
 * Public Banner Function
 * ========================================================================= */

void dh_banner(void) {
    /* Try OSReport first (fastest path) */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Initialize VI if not already done */
    if (!g_vi_initialized) {
        /* Detect video mode */
        int mode = detect_video_mode();
        const vi_config* cfg = (mode == VI_PAL) ? &pal_config : &ntsc_config;
        
        /* Initialize hardware */
        vi_init_hardware(cfg);
        
        /* Clear framebuffer to black */
        clear_xfb();
        
        g_vi_initialized = 1;
    }
    
    /* Draw banner text at top-left with small margin */
    draw_text(16, 16, "Patched with DolHook");
    
    /* Flush cache for the affected region */
    asm volatile(
        "lis 3, g_xfb@ha\n"
        "addi 3, 3, g_xfb@l\n"
        "li 4, 4096\n"      // Flush first 4KB (more than enough for text)
        "1:\n"
        "dcbf 0, 3\n"
        "addi 3, 3, 32\n"
        "addic. 4, 4, -32\n"
        "bgt 1b\n"
        "sync\n"
        : : : "r3", "r4", "memory"
    );
}

#endif /* DOLHOOK_NO_BANNER */Report(const char* fmt, ...) __attribute__((weak));

#ifndef DOLHOOK_NO_BANNER

/* VI register base */
#define VI_BASE 0xCC002000

/* Simple 8x8 monospace font for ASCII 0x20-0x7F */
static const uint8_t font_8x8[96][8] = {
    /* Space through ~ */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* ' ' */
    {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}, /* '!' */
    {0x36,0x36,0x00,0x00,0x00,0x00,0x00,0x00}, /* '"' */
    {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}, /* '#' */
    {0x0C,0x3E,0x03,0x1E,0x30,0x1F,0x0C,0x00}, /* '$' */
    {0x00,0x63,0x33,0x18,0x0C,0x66,0x63,0x00}, /* '%' */
    {0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}, /* '&' */
    {0x06,0x06,0x03,0x00,0x00,0x00,0x00,0x00}, /* ''' */
    {0x18,0x0C,0x06,0x06,0x06,0x0C,0x18,0x00}, /* '(' */
    {0x06,0x0C,0x18,0x18,0x18,0x0C,0x06,0x00}, /* ')' */
    {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}, /* '*' */
    {0x00,0x0C,0x0C,0x3F,0x0C,0x0C,0x00,0x00}, /* '+' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x06}, /* ',' */
    {0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00}, /* '-' */
    {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00}, /* '.' */
    {0x60,0x30,0x18,0x0C,0x06,0x03,0x01,0x00}, /* '/' */
    {0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}, /* '0' */
    {0x0C,0x0E,0x0C,0x0C,0x0C,0x0C,0x3F,0x00}, /* '1' */
    {0x1E,0x33,0x30,0x1C,0x06,0x33,0x3F,0x00}, /* '2' */
    {0x1E,0x33,0x30,0x1C,0x30,0x33,0x1E,0x00}, /* '3' */
    {0x38,0x3C,0x36,0x33,0x7F,0x30,0x78,0x00}, /* '4' */
    {0x3F,0x03,0x1F,0x30,0x30,0x33,0x1E,0x00}, /* '5' */
    {0x1C,0x06,0x03,0x1F,0x33,0x33,0x1E,0x00}, /* '6' */
    {0x3F,0x33,0x30,0x18,0x0C,0x0C,0x0C,0x00}, /* '7' */
    {0x1E,0x33,0x33,0x1E,0x33,0x33,0x1E,0x00}, /* '8' */
    {0x1E,0x33,0x33,0x3E,0x30,0x18,0x0E,0x00}, /* '9' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x00}, /* ':' */
    {0x00,0x0C,0x0C,0x00,0x00,0x0C,0x0C,0x06}, /* ';' */
    {0x18,0x0C,0x06,0x03,0x06,0x0C,0x18,0x00}, /* '<' */
    {0x00,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00}, /* '=' */
    {0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00}, /* '>' */
    {0x1E,0x33,0x30,0x18,0x0C,0x00,0x0C,0x00}, /* '?' */
    {0x3E,0x63,0x7B,0x7B,0x7B,0x03,0x1E,0x00}, /* '@' */
    {0x0C,0x1E,0x33,0x33,0x3F,0x33,0x33,0x00}, /* 'A' */
    {0x3F,0x66,0x66,0x3E,0x66,0x66,0x3F,0x00}, /* 'B' */
    {0x3C,0x66,0x03,0x03,0x03,0x66,0x3C,0x00}, /* 'C' */
    {0x1F,0x36,0x66,0x66,0x66,0x36,0x1F,0x00}, /* 'D' */
    {0x7F,0x46,0x16,0x1E,0x16,0x46,0x7F,0x00}, /* 'E' */
    {0x7F,0x46,0x16,0x1E,0x16,0x06,0x0F,0x00}, /* 'F' */
    {0x3C,0x66,0x03,0x03,0x73,0x66,0x7C,0x00}, /* 'G' */
    {0x33,0x33,0x33,0x3F,0x33,0x33,0x33,0x00}, /* 'H' */
    {0x1E,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'I' */
    {0x78,0x30,0x30,0x30,0x33,0x33,0x1E,0x00}, /* 'J' */
    {0x67,0x66,0x36,0x1E,0x36,0x66,0x67,0x00}, /* 'K' */
    {0x0F,0x06,0x06,0x06,0x46,0x66,0x7F,0x00}, /* 'L' */
    {0x63,0x77,0x7F,0x7F,0x6B,0x63,0x63,0x00}, /* 'M' */
    {0x63,0x67,0x6F,0x7B,0x73,0x63,0x63,0x00}, /* 'N' */
    {0x1C,0x36,0x63,0x63,0x63,0x36,0x1C,0x00}, /* 'O' */
    {0x3F,0x66,0x66,0x3E,0x06,0x06,0x0F,0x00}, /* 'P' */
    {0x1E,0x33,0x33,0x33,0x3B,0x1E,0x38,0x00}, /* 'Q' */
    {0x3F,0x66,0x66,0x3E,0x36,0x66,0x67,0x00}, /* 'R' */
    {0x1E,0x33,0x07,0x0E,0x38,0x33,0x1E,0x00}, /* 'S' */
    {0x3F,0x2D,0x0C,0x0C,0x0C,0x0C,0x1E,0x00}, /* 'T' */
    {0x33,0x33,0x33,0x33,0x33,0x33,0x3F,0x00}, /* 'U' */
    {0x33,0x33,0x33,0x33,0x33,0x1E,0x0C,0x00}, /* 'V' */
    {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}, /* 'W' */
    {0x63,0x63,0x36,0x1C,0x1C,0x36,0x63,0x00}, /* 'X' */
    {0x33,0x33,0x33,0x1E,0x0C,0x0C,0x1E,0x00}, /* 'Y' */
    {0x7F,0x63,0x31,0x18,0x4C,0x66,0x7F,0x00}, /* 'Z' */
    /* Remaining characters simplified for space */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* '[' - ']' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, /* 'a' */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
};

/* Minimal VI text rendering */
static void draw_text_vi(const char* text) {
    /* Ultra-minimal: just try to init VI and draw text */
    /* In real implementation, would setup XFB properly */
    /* This is a stub - full VI init is complex */
    (void)text; /* Suppress warning */
    
    /* TODO: Full VI/XFB initialization if OSReport unavailable */
    /* For size budget, we skip full implementation */
}

void dh_banner(void) {
    /* Try OSReport first */
    if (OSReport) {
        OSReport("Patched with DolHook\n");
        return;
    }
    
    /* Fallback: minimal VI rendering */
    draw_text_vi("Patched with DolHook");
}

#endif /* DOLHOOK_NO_BANNER */